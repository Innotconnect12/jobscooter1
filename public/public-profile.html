<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobScooter Profile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .profile-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            margin: 0 auto 20px;
            border: 4px solid rgba(255,255,255,0.3);
        }

        .profile-content {
            padding: 40px;
        }

        .section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .traffic-light-visual {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .light {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #ddd;
            opacity: 0.3;
        }

        .light.active {
            opacity: 1;
            box-shadow: 0 0 15px currentColor;
        }

        .light.red { background: #e74c3c; }
        .light.yellow { background: #f1c40f; }
        .light.green { background: #27ae60; }

        .loading {
            text-align: center;
            padding: 60px 40px;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 60px 40px;
            color: #e74c3c;
        }

        .powered-by {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="profile-container">
        <div id="loading" class="loading">
            <h2>Loading Profile...</h2>
            <p>Please wait while we load the profile information.</p>
        </div>

        <div id="error" class="error" style="display: none;">
            <h2>Profile Not Found</h2>
            <p>The requested profile could not be found or is not publicly available.</p>
        </div>

        <div id="profile" style="display: none;">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">JS</div>
                <h1 id="profileName">Loading...</h1>
                <p id="profileTitle">JobScooter Verified Profile</p>
                
                <div class="traffic-light-visual">
                    <div class="light red" id="redLight"></div>
                    <div class="light yellow" id="yellowLight"></div>
                    <div class="light green" id="greenLight"></div>
                </div>
                <p><strong id="trafficStatus">Verified</strong> - <span id="trafficScore">Score</span></p>
            </div>

            <div class="profile-content">
                <div class="section">
                    <h3>üè† Location</h3>
                    <p id="profileCountry">Loading...</p>
                </div>

                <div class="section">
                    <h3>üåç Languages</h3>
                    <p id="profileLanguages">Loading...</p>
                </div>

                <div class="section">
                    <h3>üéì Qualifications</h3>
                    <p id="profileQualifications">Loading...</p>
                </div>

                <div class="section">
                    <h3>‚úÖ Verification Status</h3>
                    <ul>
                        <li>‚úÖ Identity Verified</li>
                        <li>‚úÖ Email Verified</li>
                        <li id="verificationExtras">‚úÖ JobScooter Verified</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="powered-by">
            Powered by <strong>JobScooter</strong> ‚Ä¢ AI-Powered Career Verification
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const pathParts = window.location.pathname.split('/');
            const profileSlug = pathParts[pathParts.length - 1];

            if (!profileSlug || profileSlug === 'profile') {
                showError();
                return;
            }

            try {
                // Try to fetch public profile data
                const response = await fetch(`/api/public/profile/${profileSlug}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showProfile(data);
                } else {
                    showError();
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                showError();
            }
        });

        function showProfile(data) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('profile').style.display = 'block';

            // Update profile information
            const fullName = `${data.first_name || ''} ${data.surname || ''}`.trim();
            document.getElementById('profileName').textContent = fullName || 'JobScooter User';
            
            const initials = `${data.first_name?.charAt(0) || ''}${data.surname?.charAt(0) || ''}`;
            document.getElementById('profileAvatar').textContent = initials || 'JS';

            document.getElementById('profileCountry').textContent = data.country || 'Location not specified';
            
            // Languages
            if (data.languages_count && data.languages_count > 0) {
                document.getElementById('profileLanguages').textContent = 
                    `${data.languages_count} verified language certification(s)`;
            } else {
                document.getElementById('profileLanguages').textContent = 'Language certifications pending';
            }

            // Qualifications
            if (data.certificates_count && data.certificates_count > 0) {
                document.getElementById('profileQualifications').textContent = 
                    `${data.certificates_count} verified certificate(s)`;
            } else {
                document.getElementById('profileQualifications').textContent = 'Certificates pending verification';
            }

            // Traffic light
            updateTrafficLight(data.traffic_light_status || 'red', data.traffic_light_score || 20);
        }

        function updateTrafficLight(status, score) {
            // Reset all lights
            document.querySelectorAll('.light').forEach(light => light.classList.remove('active'));

            // Activate current status
            document.getElementById(`${status}Light`).classList.add('active');
            
            // Update text
            const statusText = status.charAt(0).toUpperCase() + status.slice(1) + ' Light Status';
            document.getElementById('trafficStatus').textContent = statusText;
            document.getElementById('trafficScore').textContent = score + '% Verified';
        }

        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }
    </script>
</body>
</html>